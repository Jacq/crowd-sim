<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src\sim\Entities\Helpers\LinePrototype.js - CrowdSim</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="CrowdSim" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.3</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/2 Dimensional Vector.html">2 Dimensional Vector</a></li>
                                <li><a href="../classes/Agent.html">Agent</a></li>
                                <li><a href="../classes/AssignableToGroup.html">AssignableToGroup</a></li>
                                <li><a href="../classes/Behavior.html">Behavior</a></li>
                                <li><a href="../classes/Colors.html">Colors</a></li>
                                <li><a href="../classes/Common utilities.html">Common utilities</a></li>
                                <li><a href="../classes/Context.html">Context</a></li>
                                <li><a href="../classes/CrowdSim.html">CrowdSim</a></li>
                                <li><a href="../classes/CrowdSimApp.html">CrowdSimApp</a></li>
                                <li><a href="../classes/Detail.html">Detail</a></li>
                                <li><a href="../classes/Engine.html">Engine</a></li>
                                <li><a href="../classes/Entity.html">Entity</a></li>
                                <li><a href="../classes/EntityPrototype.html">EntityPrototype</a></li>
                                <li><a href="../classes/Fonts.html">Fonts</a></li>
                                <li><a href="../classes/Grid.html">Grid</a></li>
                                <li><a href="../classes/Group.html">Group</a></li>
                                <li><a href="../classes/Joint.html">Joint</a></li>
                                <li><a href="../classes/Line.html">Line</a></li>
                                <li><a href="../classes/LinePrototype.html">LinePrototype</a></li>
                                <li><a href="../classes/Panic.html">Panic</a></li>
                                <li><a href="../classes/Path.html">Path</a></li>
                                <li><a href="../classes/Render.html">Render</a></li>
                                <li><a href="../classes/Wall.html">Wall</a></li>
                                <li><a href="../classes/World.html">World</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/Agent.html">Agent</a></li>
                                <li><a href="../modules/Base.html">Base</a></li>
                                <li><a href="../modules/Behavior.html">Behavior</a></li>
                                <li><a href="../modules/Common.html">Common</a></li>
                                <li><a href="../modules/Context.html">Context</a></li>
                                <li><a href="../modules/CrowdSim.html">CrowdSim</a></li>
                                <li><a href="../modules/CrowdSimApp.html">CrowdSimApp</a></li>
                                <li><a href="../modules/Detail.html">Detail</a></li>
                                <li><a href="../modules/Engine.html">Engine</a></li>
                                <li><a href="../modules/Entities.html">Entities</a></li>
                                <li><a href="../modules/Entity.html">Entity</a></li>
                                <li><a href="../modules/Group.html">Group</a></li>
                                <li><a href="../modules/Joint.html">Joint</a></li>
                                <li><a href="../modules/LinePrototype.html">LinePrototype</a></li>
                                <li><a href="../modules/Panic.html">Panic</a></li>
                                <li><a href="../modules/Path.html">Path</a></li>
                                <li><a href="../modules/Render.html">Render</a></li>
                                <li><a href="../modules/Wall.html">Wall</a></li>
                                <li><a href="../modules/World.html">World</a></li>
                                <li><a href="../modules/Worlds.html">Worlds</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: src\sim\Entities\Helpers\LinePrototype.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&#x27;use strict&#x27;;

var Vec2 = require(&#x27;../../Common/Vec2&#x27;);
var Entity = require(&#x27;../Entity&#x27;);
var Joint = require(&#x27;./Joint&#x27;);

/**
 * Base class to extend Wall and Path entities with common functionalities.
 *
 * @method LinePrototype
 * @module Entities
 * @submodule LinePrototype
 * @param {String} idPrefix &#x27;W&#x27; for walls, &#x27;P&#x27; for paths
 * @param {String} type &#x27;wall&#x27; for walls, &#x27;path&#x27; for paths
 * @param {Object} defaults options
 * @param {String} id to use insted of autogenerate it, used when loading worlds
 * @return Line
 */
var LinePrototype = function(idPrefix, type, defaults, id) {
  /**
   * Line Base
   *
   * @class Line
   * @constructor
   * @param {Number} x coordinate
   * @param {Number} y coordinate
   * @param {World} parent world
   * @param {Object} [options]
   * @param {String} id to use insted of autogenerate it, used when loading world
   * @extends Entity
   */
  var Line = function(x, y, parent, options, id) {
    this.options = Lazy(options).defaults(defaults).toObject();
    this.id = id || idPrefix + Line.id++;
    Line.id = Entity.prototype.calcNewId.call(this, Line.id);
    Entity.call(this, x, y, parent, this.options);
    this.children.joints = [];
    if (x &amp;&amp; y) {
      this.addJoint(x,y,this.options);
    }
  };

  /**
   * Destroy the line
   *
   * @method destroy
   */
  Line.prototype.destroy = function() {
    for (var j in this.children.joints) {
      this.children.joints[j].parent = null;
      this.children.joints[j].destroy();
    }
    this.children.joints.length = 0;
    Entity.prototype.destroy.call(this);
  };

  /**
   * Request to add a children Joint entity.
   *
   * @method addEntity
   * @param {Joint} joint
   * @param {Object} options used for joint creation
   */
  Line.prototype.addEntity = function(joint, options) {
    // add a joint to the end or a given position by options.idx
    if (!options || options.previousJoint === null) {
      this.children.joints.push(joint);
    } else {
      var idx = this.children.joints.indexOf(options.previousJoint);
      if (idx === -1) { throw &#x27;Previous joint not found&#x27;; }
      if (idx !== 0) { // add end
        idx++;
      }
      this.children.joints.splice(idx, 0, joint);
    }
  };

  /**
   * Request to remove a children Joint entity.
   *
   * @method removeEntity
   * @param {Joint} joint
   */
  Line.prototype.removeEntity = function(joint) {
    var idx = this.children.joints.indexOf(joint);
    if (idx !== -1) {
      this.children.joints.splice(idx, 1);
      // destroy line if not contains joints
      if (this.children.joints.length === 0) {
        this.destroy();
      } else if (idx === 0 &amp;&amp; this.children.joints.length !== 0) { // relocate reference to next joint idx +1,
        //but we removed idx alreade so next is idx
        var nextJoint = this.children.joints[idx];
        this.pos[0] = nextJoint.pos[0];
        this.pos[1] = nextJoint.pos[1];
      }
    } else {
      throw &#x27;Joint not found in &#x27; + Line.type;
    }
  };

  /**
   * Request to add a list of  children Joint entities.
   *
   * @method addJoints
   * @param {Array} joints
   */
  Line.prototype.addJoints = function(joints) {
    // n joints, n-1 sections
    for (var i in joints) {
      var joint = joints[i];
      var radius = this.options.radius;
      var options = Lazy(options).defaults(defaults).toObject();
      if (joint.length === 2) {
        options.radius = joint[3];
      }
      this.addJoint(joint[0],joint[1],options);
    }
  };

  /**
   * Helper to create a new Joint.
   *
   * @method addJoint
   * @param {Number} x
   * @param {Number} y
   * @param {Object} options
   * @param {String} id to use insted of autogenerate it, used when loading worldsid
   * @return {Joint} joint
   */
  Line.prototype.addJoint = function(x, y, options, id) {
    Entity.prototype.updatePos.call(this,x,y);
    options = Lazy(options).defaults(defaults).toObject();
    var joint = new Joint(x, y, this, options, id);
    return joint;
  };

  /**
   * Gets the childen joints.
   *
   * @method getJoints
   * @return {Array} joints
   */
  Line.prototype.getJoints = function() {
    return this.children.joints;
  };

  /**
   * Get a joint index in the path/wall
   * @method getJointIdx
   * @param {Joint} joint
   * @return {Number} index or -1 if not found
   */
  Line.prototype.getJointIdx = function(joint) {
    return this.children.joints.indexOf(joint);
  };

  /**
   * Get a joint by index in the path.
   *
   * @method getJointByIdx
   * @param {Number} idx
   * @return {Joint} joint or null
   */
  Line.prototype.getJointByIdx = function(idx) {
    return this.children.joints[idx];
  };

  /**
   * Get [options.width].
   *
   * @method getWidth
   * @return {Number} width
   */
  Line.prototype.getWidth = function() {
    return this.options.width;
  };

  /**
   * Reverse the internal joints lists.
   *
   * @method reverse
   */
  Line.prototype.reverse = function() {
    this.children.joints = Lazy(this.children.joints).reverse().toArray();
  };

  /**
   * Get the projection from a point to a given segment.
   *
   * @method getProjection
   * @param {Vec2} point
   * @param {Number} segment index
   * @return {Vec2} projection from point to segment
   */
  Line.prototype.getProjection = function(point, segment) {
    if (segment &lt; 0 || segment &gt;= this.children.joints.length - 1) {
      throw &#x27;Segment out of bounds&#x27;;
    }
    var projection = Vec2.create();
    return Vec2.projectionToSegment(projection, point, this.children.joints[segment].pos, this.children.joints[segment + 1].pos);
  };

  Line.id = 0;
  Line.type = type;
  return Line;
};

module.exports = LinePrototype;

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>

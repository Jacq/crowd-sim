{"version":3,"sources":["node_modules/browserify/node_modules/browser-pack/_prelude.js","src/Agent.js","src/CrowdSim.js","src/Engine.js","src/Entity.js","src/Group.js","src/Render.js","src/Wall.js","src/World.js"],"names":[],"mappings":"AAAA;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC1BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACjBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC1EA;AACA;AACA;AACA;AACA;AACA;AACA;;ACNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC5EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACxMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACbA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"CrowdSim.js","sourceRoot":".","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","/* global window,module, exports : true, define */\r\nvar Entity = require('./Entity');\r\n\r\nvar Agent = function(group, x, y, size) {\r\n  Entity.call(this);\r\n\r\n  this.id = Agent.id++;\r\n  this.group = group;\r\n  this.pos = {\r\n    x: x,\r\n    y: y\r\n  };\r\n  this.vel = {\r\n    x: 0,\r\n    y: 0\r\n  };\r\n  this.size = size;\r\n  this.waypoint = null;\r\n};\r\n\r\nAgent.prototype.step = function(step) {\r\n  this.group.behavior(this, step);\r\n};\r\nAgent.id = 0;\r\n\r\nmodule.exports = Agent;\r\n","/* global window,module, exports : true, define */\r\n\r\nvar CrowdSim = {\r\n  Agent: require('./Agent'),\r\n  Group: require('./Group'),\r\n  World: require('./World'),\r\n  Wall: require('./Wall'),\r\n  Engine: require('./Engine'),\r\n  Render: require('./Render')\r\n};\r\n\r\nmodule.exports = CrowdSim;\r\n\r\n// browser\r\nif (typeof window === 'object' && typeof window.document === 'object') {\r\n  window.CrowdSim = CrowdSim;\r\n}\r\n","\r\nvar Engine = function(world, options) {\r\n  this.running = false;\r\n  this.iterations = 0;\r\n  //this.agentsSave = JSON.parse(JSON.stringify(world.agents));\r\n  this.world = world || {};\r\n  this.world.save();\r\n\r\n  var defaultOptions = {\r\n    timestep: 10 / 60\r\n  };\r\n  this.options = Lazy(options).defaults(defaultOptions).toObject();\r\n};\r\n\r\nEngine.prototype.setWorld = function(world) {\r\n  this.world = world;\r\n};\r\n\r\nEngine.prototype.getWorld = function() {\r\n  return this.world;\r\n};\r\n\r\nEngine.prototype.run = function() {\r\n  if (this.running) {\r\n    return;\r\n  }\r\n  this.running = true;\r\n  this.step();\r\n};\r\n\r\nEngine.prototype.step = function() {\r\n  if (this.running) {\r\n    return;\r\n  }\r\n  this.step();\r\n};\r\n\r\nEngine.prototype.step = function() {\r\n  var world = this.world;\r\n  var options = this.options;\r\n  var timestep = options.timestep;\r\n  var entities = this.world.entities;\r\n  Lazy(entities.agents).each(function(agent) {\r\n    if (agent.selected) {\r\n      world.agentSelected = agent;\r\n      return;\r\n    }\r\n    agent.step(timestep);\r\n    if (options.onStep) {\r\n      options.onStep(world);\r\n    }\r\n  });\r\n  this.iterations++;\r\n  if (this.running) {\r\n    var that = this;\r\n    setTimeout(function() {\r\n      that.step();\r\n    }, timestep);\r\n  }\r\n};\r\n\r\nEngine.prototype.stop = function() {\r\n  if (!this.running) {\r\n    return;\r\n  }\r\n  this.running = false;\r\n};\r\nEngine.prototype.reset = function() {\r\n  this.iterations = 0;\r\n  this.running = false;\r\n  this.world.restore();\r\n};\r\n\r\nmodule.exports = Engine;\r\n","\nvar Entity = function() {\n  this.extra = {};\n};\n\nmodule.exports = Entity;\n","var Agent = require('./Agent');\nvar Entity = require('./Entity');\n\nvar Group = function(world, agents, area, options) {\n  Entity.call(this);\n  options = Lazy(options).defaults({\n    pos: function(area) {\n      var x = area[0][0] + Math.random() * (area[1][0] - area[0][0]);\n      var y = area[0][1] + Math.random() * (area[1][1] - area[0][1]);\n      return [x, y];\n    },\n    size: function() {\n      return 5;\n    },\n    behavior: this.behaviorWaypoints\n  }).toObject();\n  this.id = Group.id++;\n\n  this.behavior = options.behavior;\n  this.world = world;\n  var that = this;\n  this.agents = Lazy.generate(function(e) {\n    var pos = options.pos(area);\n    var size = isNaN(options.size) ? options.size() : options.size;\n    return new Agent(that, pos[0], pos[1], size);\n  }, agents).toArray();\n\n  if (options.waypoints) {\n    this.waypoints = options.waypoints;\n  }\n};\n\nGroup.prototype.addAgent = function(agent) {\n  this.agents.push(agent);\n};\n\nGroup.prototype.getArea = function() {\n  return {\n    xmin: Lazy(this.agents).map(function(e) { return e.pos.x - e.size; }).min(),\n    xmax: Lazy(this.agents).map(function(e) { return e.pos.x + e.size; }).max(),\n    ymin: Lazy(this.agents).map(function(e) { return e.pos.y - e.size; }).min(),\n    ymax: Lazy(this.agents).map(function(e) { return e.pos.y + e.size; }).max()\n  };\n};\n\nGroup.prototype.addAgent = function(agent) {\n  this.agents.concat(agent);\n};\n\nGroup.prototype.behaviorWaypoints = function(agent, step) {\n  var accel = {x: Math.random() * 2 - 1, y: Math.random() * 2 - 1};\n  agent.vel.x += accel.x * step;\n  agent.vel.y += accel.y * step;\n  //this.direction = Math.atan2(entity.vel.y, entity.vel.x);\n  agent.pos.x += agent.vel.x * step;\n  agent.pos.y += agent.vel.y * step;\n\n  if (this.world.wrap) {\n    if (agent.pos.x > this.world.MAX_X) {\n      agent.pos.x = this.world.MIN_X + agent.pos.x - world.MAX_X;\n    }\n    if (agent.pos.x < this.world.MIN_X) {\n      agent.pos.x = this.world.MAX_X - (this.world.MIN_X - entity.pos.x);\n    }\n    if (agent.pos.y > this.world.MAX_Y) {\n      agent.pos.y = this.world.MIN_Y + entity.pos.y - this.world.MAX_Y;\n    }\n    if (agent.pos.y < this.world.MIN_Y) {\n      agent.pos.y = this.world.MAX_Y - (this.world.MIN_Y - entity.pos.y);\n    }\n  }\n};\n\nGroup.id = 0;\n\nmodule.exports = Group;\n","\r\nvar Colors = {\r\n  Agent: 0xFF0000,\r\n  Wall: 0x00FF00,\r\n  Group: 0xe1eca0,\r\n  Joint: 0xFFFFFF,\r\n  Waypoint: 0x7a7a7a\r\n};\r\n\r\n/*\r\n* Base render prototype\r\n*/\r\nvar Entity = function(entity, container, display) {\r\n  this.entitiyModel = entity;\r\n  this.entitiyModel.extra.view = this;\r\n  // add it the container so we see it on our screens..\r\n  display.interactive = true;\r\n  display.buttonMode = true;\r\n  display.mouseover = this.mouseover;\r\n  display.mouseout = this.mouseout;\r\n  display._entityView = this;\r\n  this.display = display;\r\n  container.addChild(this.display);\r\n};\r\n\r\nEntity.prototype.update = function() {\r\n  //this.display.clear();\r\n};\r\n\r\nEntity.prototype.mouseover = function() {\r\n  var entity = this._entityView.entityModel;\r\n  console.log(entity.id + ': Mouse Over');\r\n  agent.selected = true;\r\n};\r\n\r\nEntity.prototype.mouseout = function() {\r\n  this._entityView.entityModel.selected = false;\r\n};\r\n\r\nvar Agent = function(agent, container, options) {\r\n  var display = new PIXI.Graphics();\r\n  Entity.call(this, agent, container, display);\r\n  this.display.beginFill(Colors.Agent);\r\n  this.circle = new PIXI.Circle(agent.pos.x, agent.pos.y, agent.size);\r\n\r\n  this.update();\r\n};\r\n\r\nAgent.prototype.update = function() {\r\n  if (!Agent.show || !Agent.show.all) {\r\n    this.display.clear();\r\n    return;\r\n  }\r\n  Entity.prototype.update.call(this);\r\n\r\n  var e = this.entitiyModel;\r\n  // direction line\r\n  var scale = 10;\r\n  this.circle.x = e.pos.x;\r\n  this.circle.y = e.pos.y;\r\n\r\n  if (Agent.show.body) {\r\n    this.display.beginFill(Colors.Agent);\r\n    this.display.drawShape(this.circle);\r\n    this.display.lineStyle(1, Colors.Agent);\r\n  }\r\n  if (Agent.show.direction) {\r\n    this.display.moveTo(e.pos.x, e.pos.y);\r\n    this.display.lineTo(e.pos.x + e.vel.x * scale, e.pos.y + e.vel.y * scale);\r\n    this.display.endFill();\r\n  }\r\n  //console.log(e);\r\n};\r\nAgent.show = {body: true, direction: true, all: true};\r\n\r\nvar AgentSprite = function(agent, container, texture) {\r\n  var sprite = new PIXI.Sprite(texture);\r\n  //var display = new PIXI.Sprite(options.texture);\r\n  Entity.call(this, agent, container, sprite);\r\n  this.display.visible = Agent.show.body;\r\n  this.display.anchor.set(0.5);\r\n  //this.display.alpha = 0.5;\r\n  this.display.height = agent.size;\r\n  this.display.width = agent.size;\r\n  this.display.position.x = agent.pos.x;\r\n  this.display.position.y = agent.pos.y;\r\n  this.update();\r\n};\r\n\r\nAgentSprite.prototype.update = function() {\r\n  if (!Agent.show || !Agent.show.all) {\r\n    return;\r\n  }\r\n  Entity.prototype.update.call(this);\r\n\r\n  var e = this.entitiyModel;\r\n  this.display.position.set(e.pos.x, e.pos.y);\r\n  this.display.rotation = Math.atan2(e.vel.y, e.vel.x) - Math.PI / 2;\r\n};\r\nAgentSprite.show = {body: true, direction: true, all: true};\r\n\r\nvar Wall = function(wall, container) {\r\n  var display = new PIXI.Graphics();\r\n  Entity.call(this, wall, container, display);\r\n  this.joints = [];\r\n  for (var j in wall.path) {\r\n    var joint = wall.path[j];\r\n    var circle = new PIXI.Circle(joint[0], joint[1], wall.width);\r\n    this.joints.push(circle);\r\n  }\r\n  this.update();\r\n};\r\n\r\nWall.prototype.update = function(options) {\r\n  if (!Wall.show || !Wall.show.all) {\r\n    this.display.clear();\r\n    return;\r\n  }\r\n  Entity.prototype.update.call(this);\r\n  //this.display.clear();\r\n  var path = wall.path;\r\n  if (Wall.show.path) {\r\n    //this.display.beginFill(Colors.Wall, 0.1);\r\n    this.display.lineStyle(wall.width, Colors.Wall);\r\n    this.display.moveTo(path[0][0], path[0][1]);\r\n    for (var i = 1; i < path.length ; i++) {\r\n      this.display.lineTo(path[i][0], path[i][1]);\r\n    }\r\n    //this.display.endFill();\r\n  }\r\n  if (Wall.show.corners) {\r\n    this.display.beginFill(Colors.Joint);\r\n    for (var j in this.joints) {\r\n      this.display.drawShape(this.joints[j]);\r\n    }\r\n    this.display.endFill();\r\n  }\r\n};\r\nWall.show = {path: true, corners: true, all: true};\r\n\r\nvar Group = function(group, container) {\r\n  var display = new PIXI.Graphics();\r\n  Entity.call(this, group, container, display);\r\n  this.area = new PIXI.Rectangle(0, 0, 0, 0);\r\n  var wps = group.waypoints;\r\n  if (wps) {\r\n    this.waypoints = [];\r\n    for (var i in wps) {\r\n      var wp = wps[i];\r\n      var circle = new PIXI.Circle(wp[0], wp[1], 1);\r\n      this.waypoints.push(circle);\r\n    }\r\n  }\r\n  this.update();\r\n};\r\n\r\nGroup.prototype.update = function(options) {\r\n  if (!Group.show || !Group.show.all) {\r\n    this.display.clear();\r\n    return;\r\n  }\r\n  this.display.clear();\r\n  Entity.prototype.update.call(this);\r\n  var group = this.entitiyModel;\r\n  if (!group.agents || group.agents.length === 0) {\r\n    return;\r\n  }\r\n  if (Group.show.area) {\r\n    var limits = group.getArea();\r\n    this.area.x = limits.xmin;\r\n    this.area.y = limits.ymin;\r\n    this.area.width = limits.xmax - limits.xmin;\r\n    this.area.height = limits.ymax - limits.ymin;\r\n\r\n    this.display.beginFill(Colors.Group, 0.2);\r\n    this.display.drawShape(this.area);\r\n    this.display.endFill();\r\n  }\r\n  var wps = this.waypoints;\r\n  if (Group.show.waypoints && wps) {\r\n    this.display.lineStyle(1, Colors.Group);\r\n    this.display.beginFill(Colors.Joint);\r\n    for (var i in wps) {\r\n      this.display.drawShape(wps[i]);\r\n    }\r\n    this.display.endFill();\r\n    //\r\n    this.display.moveTo(wps[0].x, wps[0].y);\r\n    for (var j = 1; j < wps.length; j++) {\r\n      this.display.lineTo(wps[j].x, wps[j].y);\r\n    }\r\n  }\r\n};\r\n\r\nGroup.show = {area: true, waypoints: true, all: true};\r\n\r\nmodule.exports.Agent = Agent;\r\nmodule.exports.AgentSprite = AgentSprite;\r\nmodule.exports.Wall = Wall;\r\nmodule.exports.Group = Group;\r\n","\nvar Entity = require('./Entity');\n\nvar Wall = function(path, options) {\n  Entity.call(this);\n  if (!path || path.length < 2) {\n    throw 'Walls must have at least two points';\n  }\n  this.width = this.options ? options.width || 2 : 2;\n  this.path = path;\n};\n\nmodule.exports = Wall;\n","/* global window,module, exports : true, define */\r\n\r\nvar World = function(x1, y1, x2, y2) {\r\n  this.entities = {\r\n    groups: [new CrowdSim.Group(this,0)],\r\n    agents: [],\r\n    walls: []\r\n  };\r\n  this.wrap = true;\r\n  this.x1 = x1;\r\n  this.y1 = y1;\r\n  this.x2 = x2;\r\n  this.y2 = y2;\r\n};\r\n\r\nWorld.prototype.getDefaultGroup = function() {\r\n  return this.entities.groups.first();\r\n};\r\n\r\nWorld.prototype.addGroup = function(group) {\r\n  this.entities.groups = this.entities.groups.concat(group);\r\n  this.entities.agents = this.entities.agents.concat(group.agents);\r\n};\r\n\r\nWorld.prototype.addWall = function(wall) {\r\n  this.entities.walls = this.entities.walls.concat(wall);\r\n};\r\n\r\nWorld.prototype.save = function() {\r\n  this.agentsSave = JSON.stringify(this.agents);\r\n};\r\nWorld.prototype.restore = function() {\r\n  this.entities.agents = JSON.parse(this.agentsSave);\r\n};\r\n\r\nmodule.exports = World;\r\n"]}